@page "/rUsuario"

	<EditForm Model="Usuario" OnValidSubmit="Guardar">
		<DataAnnotationsValidator />

		<div class="container">
			<div class="modal-content">
				<center>
					<h5>Registrar usuarios</h5>
				</center>
				<div class="form-group">
					<label for="idusuario">Usuario Id</label>
					<div class="input-group col-3">
						<InputNumber @bind-Value="@Usuario.UsuarioId" class="form-control" />
						<ValidationMessage For="@(()=>Usuario.UsuarioId)" />
						<button type="button" class="btn btn-outline-secondary" @onclick="Buscar">Buscar</button>
					</div>
				</div>

				<div class="input-field col s6">
					<label for="nombres">Nombres</label>
					<InputText @bind-Value="@Usuario.Nombres" class="form-control" />
					<ValidationMessage For="@(()=>Usuario.Nombres)" />
				</div>

				<div class="input-field col s6">
					<label for="email">Email</label>
					<input type="email" @bind="@Usuario.Email" class="form-control" />
					<ValidationMessage For="@(()=>Usuario.Email)" />
				</div>

				<div class="input-field col s6">
					<label for="nivelUser">Nivel de Usuario</label>
					<InputSelect @bind-Value="NivelSelect" class="form-control">
						<option value="" disabled selected>Seleccione Tipo de Usuario</option>
						<option value="Usuario">Usuario</option>
						<option value="Administrador">Administrador</option>
					</InputSelect>
				</div>

				<div class="input-field col s6">
					<label for="usuario">Usuario</label>
					<InputText @bind-Value="@Usuario.Usuario" class="form-control" />
					<ValidationMessage For="@(()=>Usuario.Usuario)" />
				</div>

				<div class="input-field col s6">
					<label for="Contraseña">Contraseña</label>
					<input type="password" @bind="@Usuario.Contraseña" class="form-control" />
					<ValidationMessage For="@(()=>Usuario.Contraseña)" />
				</div>

				<div class="input-field col s6">
					<label for="fecha">Fecha de Ingreso</label>
					<InputDate @bind-Value="@Usuario.FechaIngreso" class="form-control" />
					<ValidationMessage For="@(()=>Usuario.FechaIngreso)" />
				</div>
				<br />
				<br />
				<div class="input-field col s6">
					<button type="button" class="btn btn-outline-primary" @onclick="Limpiar">Limpiar</button>
					<button type="submit" class="btn btn-outline-secondary">Guardar</button>
					<button type="button" class="btn btn-outline-danger" @onclick="Eliminar">Eliminar</button>
				</div>

			</div>
		</div>

		<h5 class="text-success">@mensaje</h5>
	</EditForm>


@code {

	protected override void OnInitialized()
	{
		Usuario = new Usuarios();
	}

	public Usuarios Usuario { get; set; }
	public string mensaje;

	private string NivelSelect;

	UsuarioController controller = new UsuarioController();

	public void Guardar()
	{
		if (controller.Guardar(Usuario))
		{
			Limpiar();
			mensaje = "Usuario Guardado con Exito!!!";
		}
		else
		{
			Limpiar();
			mensaje = "Error al guardar usuario";
		}
	}

	public void Buscar()
	{
		var usuario = controller.Buscar(Usuario.UsuarioId);

		if (usuario != null)
		{
			Usuario = usuario;
		}
		else
		{
			Limpiar();
			mensaje = "Usuario no Existe";
		}
	}

	public void Eliminar()
	{
		var usuario = controller.Buscar(Usuario.UsuarioId);

		if (usuario !=null)
		{
			controller.Eliminar(Usuario.UsuarioId);
			Limpiar();
			mensaje = "Usuario Eliminado";
		}
		else
		{
			Limpiar();
			mensaje = "Error al eliminar";
		}
	}

	public void Limpiar()
	{
		this.Usuario = new Usuarios();
		mensaje = "";
	}
}
