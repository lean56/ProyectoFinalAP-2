@page "/rCategorias"
@inject IToastService toastService

<EditForm Model="Categoria" OnValidSubmit="Guardar">
	<DataAnnotationsValidator />

	<div class="container center">

		<center>
			<h2>Registro de Categorias</h2>
		</center>

		<div class="form-group row">
			<label for="categoriaId " class="col-auto">Categoria Id</label>
			<div class="input-group  col-sm-3">
				<InputNumber @bind-Value="@Categoria.CategoriaId" class="form-control" />
				<div class="input-group-append">
					<button type="button" class="btn btn-outline-dark" @onclick="Buscar">Buscar</button>
				</div>
			</div>
		</div>
		<div class="form-group row">

			<label for="nombre">Nombre</label>
			<div class="col-6 ">
				<InputText @bind-Value="@Categoria.Nombre" class="form-control" placeholder="Nombre" />
				<ValidationMessage For="@(()=>Categoria.Nombre)" />
			</div>
		</div>

		<div class="input-field col s6">
			<button type="button" class="btn btn-outline-primary" @onclick="Limpiar">Limpiar</button>
			<button type="submit" class="btn btn-outline-secondary">Guardar</button>
			<button type="button" class="btn btn-outline-danger" @onclick="Eliminar">Eliminar</button>
		</div>

		<h5 class="text-success">@mensaje</h5>

	</div>
</EditForm>


@code {
	protected override void OnInitialized()
	{
		Categoria = new Categoria();
	}

	public Categoria Categoria { get; set; }
	public string mensaje;


	CategoriaController controller = new CategoriaController();

	public void Guardar()
	{
		if (controller.Guardar(Categoria))
		{
			Limpiar();
			mensaje = "Categoria Guardada con Exito!!!";
			toastService.ShowSuccess("Categoria Guardada", "Exito");
		}
		else
		{
			Limpiar();
			mensaje = "Error al guardar Categoria";
		}
	}

	public void Buscar()
	{
		var categoria = controller.Buscar(Categoria.CategoriaId);

		if (categoria != null)
		{
			Categoria = categoria;
		}
		else
		{
			Limpiar();
			mensaje = "Categoria no Existe";
		}
	}

	public void Eliminar()
	{
		var categoria = controller.Buscar(Categoria.CategoriaId);

		if (categoria != null)
		{
			controller.Eliminar(Categoria.CategoriaId);
			Limpiar();
			mensaje = "Categoria Eliminada";
		}
		else
		{
			Limpiar();
			mensaje = "Error al eliminar";
		}
	}

	public void Limpiar()
	{
		this.Categoria = new Categoria();
		mensaje = "";
	}
}
